// @ts-check
import starlight from '@astrojs/starlight';
import { defineConfig } from 'astro/config';
import starlightAutoSidebar from 'starlight-auto-sidebar';
import starlightTypeDoc from 'starlight-typedoc';

import angular from '@analogjs/astro-angular';
import umami from '@yeskunall/astro-umami';

const UMAMI_WEBSITE_ID = process.env.UMAMI_WEBSITE_ID || '';

export default defineConfig({
  base: '/docs',
  integrations: [
    umami({
      id: UMAMI_WEBSITE_ID,
    }),
    angular({
      vite: {
        transformFilter: (_code, id) => {
          return id.includes('src/components/angular');
        },
        inlineStylesExtension: 'scss|sass|less',
        include: ['@angular/compiler'],
        jit: true,
      },
    }),
    starlight({
      title: 'NgDiagram',
      logo: {
        light: './src/assets/ng-diagram-logo-black.svg',
        dark: './src/assets/ng-diagram-logo-white.svg',
      },
      customCss: ['./src/styles/custom.css'],
      social: [{ icon: 'github', label: 'GitHub', href: 'https://github.com/synergycodes/ng-diagram' }],
      sidebar: [
        {
          label: 'Intro',
          autogenerate: { directory: 'intro' },
        },
        {
          label: 'Internals',
          autogenerate: { directory: 'internals' },
          collapsed: true,
        },
        {
          label: 'Examples',
          autogenerate: { directory: 'examples' },
          collapsed: true,
        },
        {
          label: 'API',
          autogenerate: { directory: 'api', collapsed: true },
          collapsed: false,
        },
      ],
      plugins: [
        starlightAutoSidebar(),
        starlightTypeDoc({
          entryPoints: ['../../packages/ng-diagram/projects/ng-diagram/src/public-api.ts'],
          tsconfig: '../../packages/ng-diagram/projects/ng-diagram/tsconfig.lib.json',
          typeDoc: {
            router: 'category',
            disableSources: true,
            excludeNotDocumented: true,
            // Temporary fix to remove autogenerated README from docs.
            // TypeDoc option `readme: undefined` is not supported by the plugin.
            entryFileName: '_readme',
            excludeInternal: true,
            excludePrivate: true,
          },
          watch: true,
        }),
      ],
    }),
  ],
});
