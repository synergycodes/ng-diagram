---
import { Icon } from '@astrojs/starlight/components';
---

{/* This is intentionally inlined to avoid FOUC. - custom script */}
<script is:inline>
    window.StarlightThemeProvider = (() => {
        const storedTheme =
            typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
        const theme =
            storedTheme ||
            'dark'; // dark mode by default
        document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
        return {
            updatePickers(theme = storedTheme || 'dark') {
                document.querySelectorAll('starlight-theme-select').forEach((picker) => {
                    const select = picker.querySelector('select');
                    if (select) select.value = theme;
                    /** @type {HTMLTemplateElement | null} */
                    const tmpl = document.querySelector(`#theme-icons`);
                    const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
                    if (newIcon) {
                        const oldIcon = picker.querySelector('svg.label-icon');
                        if (oldIcon) {
                            oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
                        }
                    }
                });
            },
        };
    })();
</script>

<template id="theme-icons">
    <Icon name="sun" class="light" />
    <Icon name="moon" class="dark" />
</template>