---
import { Code } from "@astrojs/starlight/components";
import type { ComponentProps } from 'astro/types';
import { extractCodeHighlights } from './extract-code-highlights';

type Props = ComponentProps<typeof Code> & {
  sectionId?: string;
};

const { code, sectionId, ...rest } = Astro.props;

const forbiddenProps = ['mark', 'collapse', 'range'];

if (Object.keys(rest).some(prop => forbiddenProps.includes(prop))) {
  throw new Error('Use code comments for code highlighting in favour of manual props.');
}

const { finalCode, highlightProps } = extractCodeHighlights(code, sectionId);
---

<Code code={finalCode} {...highlightProps} {...rest} />
